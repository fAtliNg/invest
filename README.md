# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –¥–µ–ø–ª–æ—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Frontend + Backend + Database) –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä.

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –õ–æ–∫–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
–î–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–µ–ø–ª–æ—è —Å –≤–∞—à–µ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ (macOS/Linux) —Ç—Ä–µ–±—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã:
- **Bash** (—Ç–µ—Ä–º–∏–Ω–∞–ª)
- **SSH –∫–ª–∏–µ–Ω—Ç** (`ssh`, `scp`)
- **sshpass** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è)
  - macOS: `brew install sshpass`
  - Ubuntu: `sudo apt install sshpass`

### –°–µ—Ä–≤–µ—Ä–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
–°–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (`setup.sh`) –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ **Ubuntu 24.04**.
–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É:
- –ß–∏—Å—Ç–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Ubuntu (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- –î–æ—Å—Ç—É–ø –ø–æ SSH (root –∏–ª–∏ sudo user)
- –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã 80 (HTTP) –∏ 443 (HTTPS)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
–ü–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –¥–µ–ø–ª–æ–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä (—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞).
–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç `setup.sh` –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞:

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./deploy/setup.sh <user@host> [password]
./deploy/setup.sh root@123.45.67.89 MySecretPassword
```

*–ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ SSH –∫–ª—é—á–∞–º.*

### 2. –ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π
–î–ª—è –¥–µ–ø–ª–æ—è –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ë–î -> –ë—ç–∫–µ–Ω–¥ -> –§—Ä–æ–Ω—Ç–µ–Ω–¥) –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä `deploy.sh`:

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./deploy/deploy.sh <user@host> [-p password]
./deploy/deploy.sh root@123.45.67.89 -p MySecretPassword
```

–°–∫—Ä–∏–ø—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç:
1.  **Deploy DB**: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π Liquibase.
2.  **Deploy Backend**: –°–±–æ—Ä–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ API –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
3.  **Deploy Frontend**: –°–±–æ—Ä–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ Nginx/Frontend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

## üõ† –û—Ç–¥–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–µ–ø–ª–æ—è

–í—ã –º–æ–∂–µ—Ç–µ –¥–µ–ø–ª–æ–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏:

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
–û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î (Liquibase –º–∏–≥—Ä–∞—Ü–∏–∏).
```bash
./deploy/deploy_db.sh root@123.45.67.89 -p MySecretPassword
```

### –ë—ç–∫–µ–Ω–¥
–û–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–¥ API —Å–µ—Ä–≤–µ—Ä–∞.
```bash
./deploy/deploy_backend.sh root@123.45.67.89 -p MySecretPassword
```

### –§—Ä–æ–Ω—Ç–µ–Ω–¥
–û–±–Ω–æ–≤–ª—è–µ—Ç –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é —á–∞—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Next.js + Nginx).
```bash
./deploy/deploy_frontend.sh root@123.45.67.89 -p MySecretPassword
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `deploy/docker-compose.yml`.

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|-----------------------|
| `DB_USER` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å PostgreSQL | `postgres` |
| `DB_PASSWORD` | –ü–∞—Ä–æ–ª—å PostgreSQL | `postgres` |
| `DB_NAME` | –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö | `invest` |
| `NEXT_PUBLIC_WS_URL` | WebSocket URL –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ | `ws://korgeflus.fvds.ru/api/ws` |

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤ –ø–∞–ø–∫–µ `~/invest/deploy/` –∏–ª–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `deploy/docker-compose.yml` –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (Deploy)

```
deploy/
‚îú‚îÄ‚îÄ deploy.sh            # –ì–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è
‚îú‚îÄ‚îÄ setup.sh             # –°–∫—Ä–∏–ø—Ç –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ deploy_frontend.sh   # –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
‚îú‚îÄ‚îÄ deploy_backend.sh    # –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è –±—ç–∫–µ–Ω–¥–∞
‚îú‚îÄ‚îÄ deploy_db.sh         # –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ docker-compose.yml   # –û–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ (Docker Compose)
‚îú‚îÄ‚îÄ nginx.conf           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx
‚îú‚îÄ‚îÄ backend.Dockerfile   # Dockerfile –¥–ª—è –±—ç–∫–µ–Ω–¥–∞
‚îú‚îÄ‚îÄ nginx.Dockerfile     # Dockerfile –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
‚îî‚îÄ‚îÄ README.md            # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## ‚ùì –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### 1. –û—à–∏–±–∫–∞ "sshpass: command not found"
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `sshpass` –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ SSH –∫–ª—é—á–∏ (—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ `ssh-keygen` –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ `ssh-copy-id user@host`).

### 2. –û—à–∏–±–∫–∞ "Permission denied" –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å Docker
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É `docker`. –°–∫—Ä–∏–ø—Ç `setup.sh` –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –Ω–æ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –ø–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

### 3. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
ssh root@123.45.67.89
cd ~/invest/deploy
docker compose logs -f
```

### 4. –ü–æ—Ä—Ç 80 –∑–∞–Ω—è—Ç
–ï—Å–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —É–∂–µ –∑–∞–ø—É—â–µ–Ω –¥—Ä—É–≥–æ–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–∏—Å—Ç–µ–º–Ω—ã–π nginx), –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ:
```bash
systemctl stop nginx
systemctl disable nginx
```
